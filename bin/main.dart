import 'dart:io';
import 'models/models.dart';

//a helper function for getting user input
String _promptUser(String prompt) {
  stdout.write(prompt);
  return stdin.readLineSync() ?? "";
}

void main() {
  //a welcome message
  print("\n${"*" * 55}");
  print("*${" " * 10}FOOTBALL GAME SIMULATOR - PROJECT 1${" " * 10}*");
  print("*${" " * 10}Design the Game. Code Your Imagination!${" " * 6}*");
  print("*" * 55);

  //creating objects (teams)
  final team1 = _createTeam("1 (HOME)");
  final team2 = _createTeam("2 (AWAY)");

//setting up the match (stadium and referee)
  print("\n${"-" * 22} MATCH SETUP ${"-" * 22}");
  final stadiumName = _promptUser("Enter stadium name: ");
  final stadiumLocation = _promptUser("Enter stadium location: ");
  final stadium = Stadium(name: stadiumName, location: stadiumLocation);

  final refereeName = _promptUser("Enter referee's name: ");
  final refereeNationality = _promptUser("Enter referee's nationality: ");
  final referee = Referee(name: refereeName, nationality: refereeNationality);

  //choosing strategies for each team
  print("\n${"-" * 19} STRATEGY SELECTION ${"-" * 18}");
  final team1Strategy = _chooseStrategy(team1.teamName);
  final team2Strategy = _chooseStrategy(team2.teamName);

  //creating and starting the game
  final game = Game(
    team1: team1,
    team2: team2,
    stadium: stadium,
    referee: referee,
    team1Strategy: team1Strategy,
    team2Strategy: team2Strategy,
  );

  print("\n\n${"-" * 15} SIMULATING MATCH ${"-" * 15}");
  //creating a small delay to build anticipation
  sleep(Duration(seconds: 2));

  game.simulate();
  game.printResult();

  print("\nThank you for playing!\n");
}

//writing a helper function to create a team interactively by the user
Team _createTeam(String teamIdentifier) {
  print("\n${"-" * 20} SETUP TEAM $teamIdentifier ${"-" * 20}");
  final teamName = _promptUser("Enter team name: ");
  final trainerName = _promptUser("Enter trainer's name: ");
  final team = Team(teamName: teamName, trainer: Trainer(name: trainerName));

  int numPlayers = 0; //for simplicity its from 1 to 5 players a team
  while (numPlayers <= 0 || numPlayers > 5) {
    numPlayers = int.tryParse(
        _promptUser("Enter number of players for ${team.teamName} (1-5): ")) ??
        0;
    if (numPlayers <= 0 || numPlayers > 5) print(
        "Invalid number. Please enter a value between 1 and 5");
  }

  for (var i = 0; i < numPlayers; i++) {
    print("\n-- Player ${i +
        1} --"); //name of the player and its id generated by a loop
    final playerName = _promptUser("  Name: ");
    final position = _choosePosition();
    team.addPlayer(Player(name: playerName, id: i + 1, position: position));
  }
  return team;
}

//writing a helper function for selecting a Position from our Position enum
Position _choosePosition() {
  print("  Choose Position:");
  // Display all available positions from the enum.
  for (var i = 0; i < Position.values.length; i++) {
    print("    ${i + 1}: ${Position.values[i].name}");
  }
  while (true) {
    String choice = _promptUser(
        "  Enter choice (1-${Position.values.length}): ");
    int? index = int.tryParse(choice);
    if (index != null && index >= 1 && index <= Position.values.length) {
      return Position.values[index - 1];
    }
    print("Invalid choice. Please try again.");
  }
}

//writing a helper function for selecting a Strategy
Strategy _chooseStrategy(String teamName) {
  print("\nChoose strategy for $teamName:");
  // Display all available strategies from the enum.
  for (var i = 0; i < Strategy.values.length; i++) {
    print("  ${i + 1}: ${Strategy.values[i].name}");
  }
  while (true) {
    String choice = _promptUser("Enter choice (1-${Strategy.values.length}): ");
    int? index = int.tryParse(choice);
    if (index != null && index >= 1 && index <= Strategy.values.length) {
      return Strategy.values[index - 1];
    }
    print("Invalid choice. Please try again.");
  }
}
///////////////////////////////////////////////////
//output of the console
/*D:/flutter/src/flutter/bin/cache/dart-sdk/bin/dart.exe --enable-asserts --no-serve-devtools D:\Development\football_game_simulator\bin\main.dart

*******************************************************
*          FOOTBALL GAME SIMULATOR - PROJECT 1          *
*          Design the Game. Code Your Imagination!      *
*******************************************************

-------------------- SETUP TEAM 1 (HOME) --------------------
Enter team name: Real Madrid
Enter trainer's name: Zinedine Zidane
Enter number of players for Real Madrid (1-5): 3

-- Player 1 --
Name: Ronaldo
Choose Position:
1: goalkeeper
2: defender
3: midfielder
4: forward
Enter choice (1-4): 4

-- Player 2 --
Name: Ramos
Choose Position:
1: goalkeeper
2: defender
3: midfielder
4: forward
Enter choice (1-4): 2

-- Player 3 --
Name: Modric
Choose Position:
1: goalkeeper
2: defender
3: midfielder
4: forward
Enter choice (1-4): 3

-------------------- SETUP TEAM 2 (AWAY) --------------------
Enter team name: Bercalona
Enter trainer's name: Pep Guardiola
Enter number of players for Bercalona (1-5): 3

-- Player 1 --
Name: Lionel Messi
Choose Position:
1: goalkeeper
2: defender
3: midfielder
4: forward
Enter choice (1-4): 4

-- Player 2 --
Name: Xavi Hernandez
Choose Position:
1: goalkeeper
2: defender
3: midfielder
4: forward
Enter choice (1-4): 3

-- Player 3 --
Name: Carles Puyol
Choose Position:
1: goalkeeper
2: defender
3: midfielder
4: forward
Enter choice (1-4): 2

---------------------- MATCH SETUP ----------------------
Enter stadium name: Santiago Bernabeu
Enter stadium location: Madrid
Enter referee's name: Pierluigi Collina
Enter referee's nationality: Italian

------------------- STRATEGY SELECTION ------------------

Choose strategy for Real Madrid:
1: offensive
2: defensive
3: balanced
4: counterAttack
5: pressing
6: parkTheBus
Enter choice (1-6): 1

Choose strategy for Bercalona:
1: offensive
2: defensive
3: balanced
4: counterAttack
5: pressing
6: parkTheBus
Enter choice (1-6): 5


--------------- SIMULATING MATCH ---------------


=============================================
MATCH SIMULATION RESULT
=============================================
Stadium: Santiago Bernabeu (Madrid) | Weather: Rainy | Turf: Natural
Referee: Pierluigi Collina (Italian) | Style: Strict
---------------------------------------------
HOME: Real Madrid (Strategy: offensive)
AWAY: Bercalona (Strategy: pressing)
---------------------------------------------
FINAL POWER SCORE:
- Real Madrid: 312
- Bercalona: 203
---------------------------------------------
WINNER: REAL MADRID

MATCH COMMENTARY:
The match between Real Madrid and Bercalona was amazing!
Under the watchful eye of referee Pierluigi Collina, both teams gave their all.
Real Madrid chose a offensive strategy, while Bercalona opted for a pressing approach.
After a hard-fought battle, Real Madrid emerged victorious!
=============================================

Thank you for playing!


Process finished with exit code 0
*/
